!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).InfiniteScroll=t()}(this,function(){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e,s=(function(e,t){e.exports=function(){var a=arguments;return function(i,o,r){var s;return o=o||15,function(){var e=void 0,t=a,n=r&&s;clearTimeout(s),s=setTimeout(function(){s=null,r||i.apply(e,t)},o),n&&i.apply(e,t)}}}()}(e={exports:{}},e.exports),e.exports);return function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:window;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.settings=function(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},t=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.forEach(function(e){var t,n,i;t=o,i=r[n=e],n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i})}return o}({element:".js-infinite",next:".js-infinite__next",item:".js-infinite__item",disabledClass:"disabled",hiddenClass:"hidden",responseType:"text/html",onComplete:function(e){}},e),this.win=n,this.doc=t,this.container=this.doc.querySelector(this.settings.element),this.next=this.doc.querySelector(this.settings.next),this.isLoading=!1,this.isAtEnd=!1,null!==this.container&&this.init()}var e,t,n;return e=i,(t=[{key:"init",value:function(){this.bind().hideNext()}},{key:"hideNext",value:function(){return this.next&&this.next.classList.add(this.settings.hiddenClass),this}},{key:"getLoadingPosition",value:function(){var e=this.container;return e.offsetTop-e.clientHeight}},{key:"getScrollPosition",value:function(){var e=this.win;return e.pageYOffset+e.innerHeight/2}},{key:"bind",value:function(){var t=this;return this.win.addEventListener("load",function(e){t.loadMore()}),this.win.addEventListener("scroll",function(e){console.log(test),s(t.loadMore())}),this}},{key:"loadMore",value:function(){var i=this;this.getScrollPosition()<this.getLoadingPosition()||this.isLoading||this.isAtEnd||!this.next||(this.isLoading=!0,this.next.classList.add(this.settings.disabledClass),this.makeRequest(this.next.href,function(e){var t=r(e.querySelectorAll(i.settings.item)).map(function(e){return e.outerHTML}).join(""),n=e.querySelector(i.settings.next)?e.querySelector(i.settings.next).getAttribute("href"):"";i.next.href=n,i.container.innerHTML+=t,i.next.classList.remove(i.settings.disabledClass),i.isLoading=!1,i.settings.onComplete(i.container),i.isAtEnd=""===n}))}},{key:"makeRequest",value:function(e,n){var i=this,o=new XMLHttpRequest;o.open("GET",e),o.onload=function(){if(200<=o.status&&o.status<400){var e=o.responseText,t=(new DOMParser).parseFromString(e,i.settings.responseType);n(t)}},o.send()}}])&&o(e.prototype,t),n&&o(e,n),i}()});
